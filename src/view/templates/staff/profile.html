{% extends 'base.html' %}
{% block title %}Staff Profile{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto p-6 bg-gray-900 rounded-lg shadow-lg text-gray-100">

  <!-- Header with photo and basic info -->
  <div class="flex items-center space-x-6 mb-6">
    <img 
      src="https://placehold.co/120x120?text=User" 
      alt="Profile Photo" 
      class="w-24 h-24 rounded-full border-4 border-indigo-600 object-cover"
      loading="lazy"
    />
    <div>
      <h1 class="text-3xl font-bold leading-tight">{{ t.Name }}</h1>
      <p class="text-indigo-400 font-medium">{{ t.email }}</p>
      <span class="inline-block mt-2 px-3 py-1 text-sm font-semibold rounded-full
        {{ 'bg-green-600 text-green-100' if t.status == 'Active' else 'bg-gray-700 text-gray-300' }}">
        {{ t.status }}
      </span>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex space-x-3 mb-8">
    <a href="/staff/edit/{{ t.id }}" 
       class="inline-flex items-center px-5 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-md text-white font-semibold transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
      </svg>
      Edit Profile
    </a>
    <a href="/staff/access/{{ t.id }}" 
       class="inline-flex items-center px-5 py-2 bg-yellow-500 hover:bg-yellow-600 rounded-md text-white font-semibold transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 1.105-.672 2-1.5 2S9 12.105 9 11s.672-2 1.5-2 1.5.895 1.5 2zM12 13c1.38 0 2.5 1.12 2.5 2.5S13.38 18 12 18s-2.5-1.12-2.5-2.5S10.62 13 12 13z" />
      </svg>
      Access Control
    </a>
    <button 
      onclick="deactivate({{ t.id }})"
      class="inline-flex items-center px-5 py-2 bg-red-600 hover:bg-red-700 rounded-md text-white font-semibold transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
      Deactivate
    </button>
  </div>

  <!-- Details Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Role Card -->
    <div class="bg-gray-800 rounded-lg p-6 shadow-inner">
      <h2 class="text-xl font-semibold mb-3 border-b border-indigo-600 pb-2">Role</h2>
      <p class="text-gray-300 text-lg">{{ t.role_data.role_name }}</p>
    </div>

    <!-- Assigned Classes Card -->
    <div class="bg-gray-800 rounded-lg p-6 shadow-inner">
      <h2 class="text-xl font-semibold mb-3 border-b border-indigo-600 pb-2">Assigned Classes</h2>
      <div class="flex flex-wrap gap-2">
        {% for c in t.class_data %}
          <span class="inline-block bg-indigo-600 px-3 py-1 rounded-full text-sm font-medium text-white">
            {{ c.CLASS }}{{ '-' + c.Section if c.Section }}
          </span>
        {% else %}
          <span class="text-gray-500 italic">No classes assigned</span>
        {% endfor %}
      </div>
    </div>

    <!-- Permissions Card (full width) -->
    <div class="bg-gray-800 rounded-lg p-6 shadow-inner md:col-span-2">
      <h2 class="text-xl font-semibold mb-3 border-b border-indigo-600 pb-2">Permissions</h2>
      <div class="flex flex-wrap gap-3">
        {% for p in permissions %}
          <span class="inline-block bg-indigo-500/90 hover:bg-indigo-600 transition px-4 py-1 rounded-full text-sm font-semibold text-white cursor-default select-none" title="{{ p.description or '' }}">
            {{ p.title or p.permission_name }}
          </span>
        {% else %}
          <span class="text-gray-500 italic">No permissions</span>
        {% endfor %}
      </div>
    </div>

  </div>

</div>

<script>
async function deactivate(id){
  if(!confirm('Deactivate this staff?')) return;
  const res = await fetch(`/staff/deactivate/${id}`, {method: 'POST'});
  const data = await res.json();
  if(res.ok){
    showAlert(200, data.message);
    setTimeout(() => location.href = '/staff', 800);
  } else {
    showAlert(res.status, data.message || 'Failed');
  }
}
</script>
{% endblock %}
