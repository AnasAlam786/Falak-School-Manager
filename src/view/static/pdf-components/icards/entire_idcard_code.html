<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>57x88mm Page</title>
  <style>
    /* Fixed ID card dimensions */
    .id-card-container {
        width: 215.433px;  /* 57mm at 96dpi */
        height: 332.598px; /* 88mm at 96dpi */
        margin: 0 auto;
        position: relative;
        overflow: hidden;
        transform: scale(1);
        transform-origin: center;
    }
    
    .page {
        image-rendering: crisp-edges;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        background: rgb(20, 56, 104);
        position: relative;
        overflow: hidden;
        font-family: 'League Spartan';
    }

    .signature img {
        max-width: 80px !important;
        max-height: 30px !important;
        width: auto !important;
        height: auto !important;
    }
    .no-image {
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.3);
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5;
    }
    
    .no-image span {
        background: rgba(0, 0, 0, 0.7);
        padding: 8px 15px;
        border-radius: 20px;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    .card-info {
        padding: 15px;
        background: var(--card-bg);
        border-top: 1px solid var(--border);
    }
    
    .student-name {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-primary);
    }
    
    .student-class {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }


</style>
</head>
<body>
  <div class="container">
    <button onclick="downloadPDF()">Download</button>
    <div class="id-cards-container">
      <div class="cards-grid" id="cards-grid">
          <!-- ID Cards will be generated here with Jinja -->
          {% for student in students %}
          <div class="card-wrapper" data-id="{{ student.id }}" data-class="{{ student.CLASS }}" data-has-image="{% if student.IMAGE %}true{% else %}false{% endif %}">
              <input type="checkbox" class="card-selector">
              <div class="id-card-container">
                  <div class="page">
                      <!-- School name in rounded effect above the image -->
                      <div style="position: absolute; top: 15%; left: 50%; transform: translate(-50%, -50%); z-index: 7;">
                          <svg width="300" height="180" viewBox="0 0 160 60">
                              <path id="curve" d="M40,40 A45,28 0 0 1 120,40" fill="transparent"/>
                              <text font-family="League Spartan" font-size="9.3" stroke="#fff" stroke-width="0.5" fill="#fff" font>
                                  <textPath href="#curve" startOffset="50%" text-anchor="middle" font-family= 'League Spartan' >
                                      {{ school.School_Name }}
                                  </textPath>
                              </text>
                          </svg>
                      </div>
                      
                      <div style="position: absolute; top: 6%; left: 50%; transform: translate(-50%, -50%); z-index: 7;">
                          <p style="font-size: 8px; font-weight: bolder; color: rgb(0, 0, 0); font-family: 'League Spartan';">UDISE: <span>{{ school.UDISE }}</span></p>
                      </div>
                      
                      <!-- School logo -->
                      <div style="position: absolute; top: 3%; left: 9.5%; z-index: 7; width: 30px; height: 30px; border-radius: 50%; overflow: hidden; background: #fff;">
                          <img src="{{ school.Logo }}"
                              alt="School Logo"
                              style="width: 100%; height: 100%; object-fit: cover; display: block;"
                              crossorigin="anonymous"
                              loading="lazy" />
                      </div>
                      
                      <!-- Session image -->
                      <div style="position: absolute; top: 3%; left: 76.5%; z-index: 7; width: 30px; height: 30px; border-radius: 50%; overflow: hidden; background: #fff;">
                          <img src="https://lh3.googleusercontent.com/d/1tJnm5i4GgSyb4HIULAb2tvbejXfrz5HZ=s200"
                              alt="profile"
                              width="100%"
                              height="100%"
                              style="object-fit: cover; display: block;" 
                              crossorigin="anonymous" 
                              loading="lazy"/>
                      </div>
                      
                      <!-- Larger white hexagon -->
                      <div style="display: flex; justify-content: center; z-index: 1; position: absolute;">
                          <svg width="57mm" viewBox="0.5 150 255 255">
                              <path 
                              d="M149.0608082214179,3.735229821355155L234.93919177773057,18.96615047161027C247.1226014561723,21.126933412318678 255.9999999994323,31.71731551342968 255.9999999994323,44.09085397654978L255.9999999994323,262.01854871132133C255.9999999994323,274.39208717444143 247.1226014561723,284.98246927555243 234.93919177773057,287.14325221626086L149.0608082214179,302.37417286651595C135.1289763427541,304.8450464180284 120.87102365667819,304.8450464180284 106.93919177801442,302.37417286651595L21.060808221701734,287.14325221626086C8.877398543259988,284.98246927555243 0,274.39208717444143 0,262.01854871132133L0,44.09085397654978C0,31.71731551342968 8.877398543259988,21.126933412318678 21.060808221701734,18.96615047161027L106.93919177801442,3.735229821355155C120.87102365667819,1.2643562698426967 135.1289763427541,1.2643562698426967 149.0608082214179,3.735229821355155Z" 
                              fill="white"/>
                          </svg>
                      </div>
                      
                      <!-- Smaller blue hexagon -->
                      <div style="display: flex; justify-content: center; z-index: 2; position: absolute;">
                          <svg viewBox="-7 150 270 270" width="50mm">
                              <path 
                              d="M149.0608082214179,3.735229821355155L234.93919177773057,18.96615047161027C247.1226014561723,21.126933412318678 255.9999999994323,31.71731551342968 255.9999999994323,44.09085397654978L255.9999999994323,262.01854871132133C255.9999999994323,274.39208717444143 247.1226014561723,284.98246927555243 234.93919177773057,287.14325221626086L149.0608082214179,302.37417286651595C135.1289763427541,304.8450464180284 120.87102365667819,304.8450464180284 106.93919177801442,302.37417286651595L21.060808221701734,287.14325221626086C8.877398543259988,284.98246927555243 0,274.39208717444143 0,262.01854871132133L0,44.09085397654978C0,31.71731551342968 8.877398543259988,21.126933412318678 21.060808221701734,18.96615047161027L106.93919177801442,3.735229821355155C120.87102365667819,1.2643562698426967 135.1289763427541,1.2643562698426967 149.0608082214179,3.735229821355155Z" 
                              fill="rgb(12, 192, 223)"/>
                          </svg>
                      </div>
                      
                      <!-- Hanging blue image frame -->
                      <div style="display: flex; justify-content: center; z-index: 4; position: absolute;">
                          <svg viewBox="-82 100 420 380" width="50mm">
                              <path 
                              d="M85.37944615384615,429.14564538832576C98.50387692307693,433.82319911988105 113.42473846153845,436.8925535373774 128.06892307692306,436.8925535373774C142.71359999999999,436.8925535373774 156.80541538461537,434.2612360841531 169.79150769230768,429.58368235259775C170.0681846153846,429.4376700311738 170.3443692307692,429.4376700311738 170.62055384615383,429.29165770974976C219.38904615384612,410.58144278352853 255.30929230769226,361.1751039593499 256,301.0669341856152L256,0L0,0L0,300.84350466690995C0.6907716923076921,361.46712860219793 36.058289230769226,410.8739833709752 85.37944615384615,429.14564538832576Z" 
                              fill="rgb(12, 192, 223)"/>
                          </svg>
                      </div>
                      
                      <!-- Student image -->
                      <div style="position: absolute; top: 29.5%; left: 50%; transform: translate(-50%, -50%); z-index: 5; width: 100px; height: 100px; border-radius: 50%; overflow: hidden; background: white; display: flex; align-items: center; justify-content: center;">
                          {% if student.IMAGE %}
                            <img src="https://lh3.googleusercontent.com/d/{{ student.IMAGE }}=s220"
                              loading="lazy"
                              alt="Student Photo"
                              style="width: 95px; height: 95px; object-position: top; object-fit: cover; display: block; border-radius: 50%;"
                              crossorigin="anonymous" />
                          {% else %}
                              <div style="background: #ccc; width: 95px; height: 95px; border-radius: 50%;"></div>
                          {% endif %}
                      </div>
                    
                      
                      <!-- Shadow -->
                      <div style="position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); z-index: 3;">
                          <svg width="200" height="200" viewBox="0 0 100 100">
                              <defs>
                                  <filter id="shadow" x="-80%" y="-80%" width="250%" height="250%">
                                      <feGaussianBlur in="SourceAlpha" stdDeviation="6" result="blur"/>
                                      <feOffset in="blur" dx="0" dy="0" result="offsetBlur"/>
                                      <feFlood flood-color="rgba(0,0,0,1)" result="darkShadow"/>
                                      <feComposite in="darkShadow" in2="offsetBlur" operator="in" result="darkBlur"/>
                                      <feComposite in="SourceGraphic" in2="darkBlur" operator="over"/>
                                  </filter>
                              </defs>
                              <circle cx="50" cy="50" r="25" fill="white" filter="url(#shadow)"/>
                          </svg>
                      </div>
                      
                      <!-- Student Information -->
                      <div style="font-family: 'League Spartan'; position: absolute; top: 52%; left: 50%; line-height: 2; transform: translate(-50%, -50%); width: 90%; text-align: center; z-index: 5;">
                          <h1 style="font-weight: bolder; font-size: 16px; color: #ffffff;">{{ student.STUDENTS_NAME }}</h1>
                          <p style="font-weight: bolder; font-size: 12px; color: #bebebe;">C/O Mr.{{ student.FATHERS_NAME }}</p>
                      </div>
                      
                      <div style="font-family: 'League Spartan'; position: absolute; top: 68%; left: 52%; transform: translate(-50%, -50%);  width: 75%; text-align: center; z-index: 5;">
                          <table style="width: 100%; border-collapse: collapse;">
                              <tbody style="color: #ffffff; line-height: 1.3;">
                                  <tr>
                                      <td style="color: #bebebe; font-weight: bolder; font-size: 9px; text-align: left; padding: 1px 0; white-space: nowrap;">Class</td>
                                      <td style="font-weight: bolder; font-size: 10px; text-align: right; padding: 1px 2px; width: 8px;">:</td>
                                      <td style="font-size: 10px; font-weight: bolder; text-align: left; padding: 1px 0;">{{ student.CLASS }} - {{ student.ROLL }}</td>
                                  </tr>
                                  <tr>
                                      <td style="color: #bebebe; font-weight: bolder; font-size: 9px; text-align: left; padding: 1px 0; white-space: nowrap;">Date of Birth</td>
                                      <td style="font-weight: bolder; font-size: 10px; text-align: right; padding: 1px 2px; width: 8px;">:</td>
                                      <td style="font-size: 10px; font-weight: bolder; text-align: left; padding: 1px 0;">{{ student.dob }}</td>
                                  </tr>
                                  <tr>
                                      <td style="color: #bebebe; font-weight: bolder; font-size: 9px; text-align: left; padding: 1px 0; white-space: nowrap;">Phone</td>
                                      <td style="font-weight: bolder; font-size: 10px; text-align: right; padding: 1px 2px; width: 8px;">:</td>
                                      <td style="font-size: 10px; font-weight: bolder; text-align: left; padding: 1px 0;">{{ student.PHONE }}</td>
                                  </tr>
                                  <tr>
                                      <td style="color: #bebebe; font-weight: bolder; font-size: 9px; text-align: left; padding: 1px 0; white-space: nowrap;">Address</td>
                                      <td style="font-weight: bolder; font-size: 10px; text-align: right; padding: 1px 2px; width: 8px;">:</td>
                                      <td style="font-size: 7.5px; font-weight: bolder; text-align: left; padding: 1px 0;">{{ student.ADDRESS }}</td>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                      
                      <!-- Signatures -->
                      <div style="font-family: 'League Spartan'; position: absolute; top: 84%; left: 25%; transform: translate(-50%, -50%); width: 90%; text-align: center; z-index: 5;">
                          <img src="https://lh3.googleusercontent.com/d/{{ student.teachers_sign | default('1tJnm5i4GgSyb4HIULAb2tvbejXfrz5HZ', true) }}"                                  
                              loading="lazy" 
                              style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 200%; max-height: 200%; object-fit: contain;">
                          <p style="font-weight: bolder; font-size: 9px; color: #919191;">Teacher's Sign</p>
                      </div>
                      
                      <div style="font-family: 'League Spartan'; position: absolute; top: 84%; left: 75%; transform: translate(-50%, -50%); width: 90%; text-align: center; z-index: 5;">
                          <img src="https://lh3.googleusercontent.com/d/14A_2bL47AwZ9ZZyhxsEpCcB1sfInjhe4"
                              loading="lazy"
                              style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 200%; max-height: 200%; object-fit: contain;">
                          <p style="font-weight: bolder; font-size: 9px; color: #919191;">Principal Sign</p>
                      </div>
                      
                      <!-- Footer -->
                      <svg style="font-family: 'League Spartan'; font-weight: bolder; position: absolute; left: 0; bottom: 0; z-index: 6;" width="100%" height="38px">
                          <rect width="100%" height="45px" fill="white"/>
                          <text  x="50%" y="24%" 
                              dominant-baseline="middle" 
                              text-anchor="middle" 
                              font-size="10px" fill="black" >
                              {{ school.Address }}
                          </text>
                          <text 
                              x="50%" y="55%" 
                              dominant-baseline="middle" 
                              text-anchor="middle" 
                              font-size="11px"
                              fill="black" >
                              +91{{ school.Phone}}
                          </text>
                      </svg>
                  </div>
              </div>
          </div>
          {% endfor %}
      </div>
  </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>



<script>
  async function downloadPDF() {
    // Ensure the League Spartan font is loaded
    await document.fonts.ready;

    const zip = new JSZip();
    const cards = document.querySelectorAll('.page');

    for (let i = 0; i < cards.length; i++) {
      const card = cards[i];
      try {

        const dataUrl = await htmlToImage.toJpeg(card, {
            quality: 1,
            width: 215.433,
            height: 332.598,
            pixelRatio: 3
          })
        const base64 = dataUrl.split(',')[1];
        zip.file(`idcard-${i + 1}.jpg`, base64, { base64: true });
      } catch (err) {
          console.error(`Error processing card ${i + 1}:`, err);
      }
    }

    // Generate and trigger ZIP download
    zip.generateAsync({ type: 'blob' })
      .then(function (content) {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(content);
        a.download = 'idcards.zip';
        a.click();
      });
  };
</script>

</body>
</html>
